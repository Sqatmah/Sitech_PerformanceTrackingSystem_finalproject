{% extends 'base.html' %}
{% load static %}

{% block title %}Profile Setup - Student Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 py-8">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full mb-4">
                <i class="fas fa-user-cog text-white text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Complete Your Profile</h1>
            <p class="text-gray-600">
                {% if user_role == 'student' %}
                    Set up your student profile to get started with assignments and tracking your progress.
                {% elif user_role == 'manager' %}
                    Configure your manager profile to oversee students and manage assignments.
                {% else %}
                    Complete your profile setup.
                {% endif %}
            </p>
        </div>

        <!-- Profile Setup Form -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="px-8 py-6 bg-gradient-to-r from-purple-600 to-blue-600">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    {% if user_role == 'student' %}
                        <i class="fas fa-graduation-cap mr-3"></i>
                    {% else %}
                        <i class="fas fa-users-cog mr-3"></i>
                    {% endif %}
                    {{ user_role|title }} Profile Setup
                </h2>
            </div>
            
            <div class="p-8">
                <form method="post" class="space-y-6">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex">
                                <i class="fas fa-exclamation-circle text-red-400 mt-0.5 mr-3"></i>
                                <div>
                                    <h3 class="text-sm font-medium text-red-800">Please correct the following errors:</h3>
                                    <ul class="mt-2 text-sm text-red-700 list-disc list-inside">
                                        {% for field, errors in form.errors.items %}
                                            {% for error in errors %}
                                                <li>{{ field|title }}: {{ error }}</li>
                                            {% endfor %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Form Fields -->
                    {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                {{ field.label }}
                                {% if field.field.required %}
                                    <span class="text-red-500">*</span>
                                {% endif %}
                            </label>
                            
                            {% if field.field.widget.input_type == 'textarea' %}
                                <textarea 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 resize-none"
                                    rows="4"
                                    placeholder="{{ field.help_text|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                >{{ field.value|default:'' }}</textarea>
                            {% elif field.field.widget.input_type == 'select' %}
                                <select 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    {% if field.field.required %}required{% endif %}
                                >
                                    {% for choice in field.field.choices %}
                                        <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>
                                            {{ choice.1 }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                <input 
                                    type="{{ field.field.widget.input_type|default:'text' }}" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    value="{{ field.value|default:'' }}"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    placeholder="{{ field.help_text|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                />
                            {% endif %}
                            
                            {% if field.help_text %}
                                <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
                            {% endif %}
                            
                            {% if field.errors %}
                                <div class="mt-1">
                                    {% for error in field.errors %}
                                        <p class="text-sm text-red-600">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                        <button 
                            type="submit" 
                            class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center"
                        >
                            <i class="fas fa-save mr-2"></i>
                            Save Profile
                        </button>
                        
                        <a 
                            href="{% url 'accounts:profile' %}" 
                            class="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center text-center"
                        >
                            <i class="fas fa-arrow-left mr-2"></i>
                            Back to Profile
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Help Section -->
        <div class="mt-8 bg-blue-50 rounded-lg p-6">
            <div class="flex items-start">
                <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                <div>
                    <h3 class="text-sm font-medium text-blue-800 mb-1">Need Help?</h3>
                    <p class="text-sm text-blue-700">
                        {% if user_role == 'student' %}
                            Complete your student profile to access assignments, track your progress, and receive feedback from your managers.
                        {% elif user_role == 'manager' %}
                            Set up your manager profile to oversee students, create assignments, and monitor performance across your team.
                        {% else %}
                            Fill out the required information to complete your profile setup.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add form validation feedback
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input, textarea, select');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.hasAttribute('required') && !this.value.trim()) {
                this.classList.add('border-red-300', 'focus:ring-red-500');
                this.classList.remove('border-gray-300', 'focus:ring-purple-500');
            } else {
                this.classList.remove('border-red-300', 'focus:ring-red-500');
                this.classList.add('border-gray-300', 'focus:ring-purple-500');
            }
        });
    });
    
    // Show success message on form submission
    form.addEventListener('submit', function() {
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
        submitBtn.disabled = true;
        
        // Re-enable button after 5 seconds in case of error
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 5000);
    });
});
</script>
{% endblock %}